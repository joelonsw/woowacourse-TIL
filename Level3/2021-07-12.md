### 2021-07-12

## 더 자바 [다이나믹 프록시]
- **java.lang.reflect.Proxy**
    - 쓰이는 곳 
        - Spring Data JPA
        - Spring AOP
- **프록시 패턴**
    - Client --> Interface
    - Interface의 실체는 Proxy
        - Proxy는 Real Subject를 가지고 있음        
    - ![](../image/2021-07-12-proxy-pattern.PNG)
    - Real Subject는 정말 핵심 비즈니스 로직만!
    - Proxy에서 추가적인 작업 수행
        - 로깅, 트랜잭션, 접근제한 등
- **다이나믹 프록시**
    - "런타임"에 하나 이상의 인터페이스들을 구현하는 클래스/인스턴스 만드는 기술
        - Proxy.newProxyInstance(클래스로더, 인터페이스의 목록, InvocationHandler)
            - 인터페이스의 목록: Java에서 제공하는 Proxy는 클래스 기반 Proxy 못 만듦
            - InvocationHandler: Proxy에 어떤 메서드가 호출될 때, 어떻게 처리할 것인가에 대한 설명... 여기에서 부가적인 처리!
    - 유연한 구조가 아님 ==> Spring AOP에서 개선!
- **클래스의 프록시가 필요하다면?**
    - 서브 클래스를 만들수 있는 라이브러리를 사용해 프록시를 만들자!
    - CGlib
        - 스프링/하이버네이트가 사용하는 라이브러리
        - 버전 호환성이 좋지 않아 라이브러리 내부에 내장된 형태
    - ByteBuddy
        - 바이트코드 조작 + 런타임 프록시 만들 때도 사용 가능
    - 서브 클래스 만드는 방법의 단점
        - 상속을 통한 프록시 생성이라, 상속이 불가능한 경우 프록시 못만들어 
            - private 생성자만 있는 경우
            - final 클래스 경우
        - 인터페이스가 있을 떄는 인터페이스의 프록시를 만들어 사용할 것

## 더 자바 [어노테이션 프로세서]
- **정의**
    - 소스코드 레벨에서 소스코드에 붙어있는 어노테이션의 정보를 읽어서, 컴파일러가 컴파일하는 중에 새로운 소스코드 생성/기존의 코드 변경
- **특징**
    - 클래스(바이트코드) 생성 가능
    - resource file 생성 가능
    - 런타임 비용이 제로
    - 기존 클래스 코드를 변경시 약간의 hack 필요
- **롬복**
    - 컴파일 시점에 어노테이션 프로세서를 사용해 소스코드의 AST를 조작함