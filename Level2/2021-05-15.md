### 2021-05-15

## 지하철 노선도 3단계 피드백
- __Controller의 역할은 무엇인가?__
    - 들어온 input 값에 대한 검증은 Controller에서 해도 되는 걸까?

- __조건 검증과 실제 행위를 각각의 메서드로 분리해라__

- __Service에서 Dao를 호출하는 메서드는 범용적인 이름으로!__

- __Service에서 조회 -> 로직 순서로 작성해야 가독성이 좋음__

- __Service가 Service를 참조해도 괜찮다__ 
    - 하지만 무분별한 사용은 금지
        - 서로 참조하면 안 됨

- __Dao는 하나의 테이블과 대응되는 것이 좋다__
    - 하나의 도메인을 하나의 Dao로 온전히 만들 수 없다면...
    - 하나의 도메인을 만드는 Repository를 두고 그 안에 필요한 Dao를 배치하는 것은 어떨까?
    - Repository VS Dao 공부하기
    - Repo이름은 SecionRepo인데 station만 반환할때도 있네...
    
## Web Layer Architecture
- *참고 1: https://devlog-wjdrbs96.tistory.com/209*
- *참고 2: https://www.petrikainulainen.net/software-development/design/understanding-spring-web-application-architecture-the-classic-way/*
- *참고 3: https://lifelife7777.tistory.com/100*
- ![](../image/webLayer-2021-05-16.png)
- __Web Layer / Presentation Layer__
    - 사용자의 요청을 똑바로 받고, 응답을 똑바로 해주는 책임
    - 다른 레이어에서 발생한 예외들도 처리해주는 책임
        - 아마 그래서 ControllerAdvice를 사용한 것이 아닐지..!
    - 인가를 통해 권한 없는 사용자들을 1차로 걸러야함
    - @Controller를 사용
    
- __Service Layer / Business Layer__
    - 어플리케이션과 인프라 서비스 포함
        - 애플리케이션 비즈니스 로직 처리와 도메인 모델의 적합성 검증 
    - 트랜잭션 관리
    - Presentation <-> Data Access, 두 계층 사이를 연결하며, 두 계층이 직접적으로 통신 않도록 함
    - @Service를 사용
    
- __Repository Layer / Data Access Layer__
    - Data 저장소와의 소통 책임
    - DB에 데이터를 CRUD

## Repository vs Dao
- *참고 1: http://egloos.zum.com/aeternum/v/1160846*
- *참고 2: https://www.baeldung.com/java-dao-vs-repository*
- __Dao의 등장__
    - 기존 EJB에서 도메인 레이어를 Session Bean으로 나타냄
        - 여기 내부로 퍼시스턴스 로직이 침투함
        - 도메인 ~ 퍼시스턴스 레이어 로직이 불분명해지면서...
    - 퍼시스턴스 로직의 명확한 분리와 캡슐화, 도메인 레이어에 객체지향적 인터페이스 필요해져서 Dao 탄생
    - 하부에 퍼시스턴스 메커니즘이 DB라는 사실 숨기려고 하지 않음
    - DB의 CRUD 쿼리와 1:1 매칭되는 오퍼레이션 제공
    - 퍼시스턴스 레이어의 일부
    - DB Table 중심

- __Dao Pattern__
    - Data persistence의 추상화로써, Table 중심
    - Dao는 DB table에 대응
    
- __Repository의 등장__
    - DDD의 기본 빌딩 블록 중 하나
    - 도메인 레이어에 객체 지향적인 "컬렉션 단위 인터페이스" 제공
    - 도메인 레이어의 일부
    - Domain 중심
    
- __Repository Pattern__
    - 도메인과 데이터 매핑 계층을 중재하여 컬렉션과 같은 도메인 객체에 접근 방법을 제공
    - Dao보다 살짝 더 높은 레벨에서... 비즈니스 로직에 더 가까이 대응됨
    - 따라서 Repository가 Dao를 사용해 데이터를 질의해오고, 도메인을 생성할 수 있음

- __Dao vs Repository__
    - Dao의 오퍼레이션이 Repository의 오퍼레이션 보다 세밀
        - 결과적으로, Repository에서 제공하는 하나의 오퍼레이션이 Dao의 여러 오버레이션에 매핑됨
    - Repository는 도메인 모델링 단계에서 하나의 개념 단위로 묶인 AGGREGATE를 도출하는 과정에서 식별
        - Repository는 도메인 규칙에 영향을 받는다!
    - Dao는 Table Data Gateway 패턴에 따라 DB 테이블 별로 생성되는 것이 일반적
    - Dao는 데이터 저장의 추상화, Repository는 객체 컬렉션의 추상화
    - Dao는 저장소에 가까운 낮은 레벨 개념, Repository는 도메인 객체에 가까운 높은 개념
    - Dao는 데이터 매핑/접근하여 쿼리를 캡슐화, Repository는 도메인-Dao의 중간으로 사용할 도메인 객체를 준비해줌
    - Dao는 Repository를 통해 구성 X, Repository는 Dao로 구성 O

## JdbcTemplate?
- *참고 1: https://atoz-develop.tistory.com/entry/%EC%8A%A4%ED%94%84%EB%A7%81-JDBC-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-JdbcTemplate*
- *참고 2: https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/jdbc/core/JdbcTemplate.html*
- __공식문서__
    - JDBC 사용을 간소화하고 자주 발생하는 에러를 피하게 해줌
    - SQL 쿼리를 실행하여 org.springframework.dao에 있는 정보로 업데이트 해줌
    - DataSource의 레퍼런스를 사용하여 구현
    
- __필요성__
    - JdbcTemplate 클래스로 손쉽게 DB와 연동!
    ```java
    @Configuration
    @ComponentScan
    public class BeanConfigClass {
        // DataSource
        @Bean
        public BasicDataSource source() {
            BasicDataSource source = new BasicDataSource();
            source.setDriverClassName("oracle.jdbc.OracleDriver");
            source.setUrl("jdbc:oracle:thin:@localhost:1521:orcl");
            source.setUsername("scott");
            source.setPassword("1234");
            return source;
        }
        // JdbcTemplate
        @Bean
        public JdbcTemplate db(BasicDataSource source) {
            JdbcTemplate db = new JdbcTemplate(source);
            return db;
        }
    }
    
    @Component
    public class JdbcDAO {
        @Autowired
        private JdbcTemplate db;
    }
    ```
    - SpringBoot에서는 안 보이던데?
        - @SpringBootApplication으로 @EnableAutoConfiguration을 설정해줌
        
- __사용법__
    - Insert: JdbcTemplate.update();
    - Select: JdbcTemplate.query();
    - Update: JdbcTemplate.update();
    - Delete: JdbcTemplate.update();

## DataSource?
- *참고 1: https://deepweller.tistory.com/6*
- *참고 2: https://docs.oracle.com/javase/7/docs/api/javax/sql/DataSource.html*
- __공식문서__
    - 물리적 데이터 소스와의 connection을 만들어주는 팩토리 객체
    - Driver Vendor에 따라 구현 방식 달라짐
        1. Basic Implementation: 스탠다드 Connection 객체 생성
        2. Connection Pooling Implementation: 자동으로 Connection Pooling에 참여하는 객체 생성
        3. Distributed Transaction Implementation: 분산 트랜잭션을 위해 사용하며, 거의 Connection Pooling 제공
    - H2, MySql, HikariCP 등등이 있네
    - jwp-chess 같은 경우...
        ```yaml
        spring.datasource.driver-class-name=com.mysql.jdbc.Driver
        spring.datasource.url=jdbc:mysql://localhost:13306/chess_db?useSSL=false&serverTimezone=UTC&characterEncoding=UTF-8
        spring.datasource.username=root
        spring.datasource.password=root
        ```
    - atdd-subway-map 같은 경우...
        ```yaml
        spring:
          datasource: # datasource 설정
            driver-class-name: org.h2.Driver
            url: jdbc:h2:mem:testdb
            username: sa
            password:
          h2:
            console:
              enabled: true     # h2 console 설정
        ```
      
- __필요성__
    - 순수 jdbc로 DB 접근시, DB 접근마다 connection 맺고 끊는 작업함
        - connection "맺고 끊는" 작업을 줄이려고, connection pool에 connection 쟁여둠
        - spring boot의 내장 WAS(Tomcat)에서 connection pool 제공
        
- __Spring Boot에서?__
    - Spring boot starter를 dependency 추가하면 Datasource 관리 구현체 제공
    - @EnableAutoConfiguration을 통해 DataSource와 JdbcTemplate에 대한 Bean 별도 등록X
        - @SpringBootApplication내에 @EnableAutoConfiguration을 포함
        - resources/application.properties에서 설정 가능
        ```yaml
        spring.datasource.url= # JDBC URL of the database.
        spring.datasource.username= # Login username of the database.
        spring.datasource.password= # Login password of the database.
        spring.datasource.driver-class-name= # Fully qualified name of the JDBC driver.
        ```

## Spring vs Spring Boot

## @Configuration

## 정규표현식
