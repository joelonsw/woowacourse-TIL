### 2021-05-24

## JVM 이해하기
- __정의__
    - 자바 바이트 코드를 OS에 특화된 코드로 변환하여 실행하는 프로그램!
    - 정해진 스펙을 구현한 여러 개의 구현체가 존재!
        - *표준 스펙: https://docs.oracle.com/javase/specs/jvms/se11/html/*

- __JVM__
    - *참고: https://howtodoinjava.com/java/basics/jdk-jre-jvm/*
    - **[Java 프로그램의 실행]**
        1. Simple.java 파일 작성
        2. javac 컴파일러를 통해 Simple.class로 바이트코드 생성
        3. 바이트코드(클래스파일)을 실행할 수 있는 JVM에서 실행
        4. JVM이 바이트코드를 native machine code로 변환하여 실행
    - **[JVM이란?]**
        - JVM은 자바 바이트코드를 실행하는 가상 머신임
        - 가장 인기있는 JVM은 오라클의 Hotspot
        - GC와 adaptive optimizer를 통해 자바 어플리케이션의 최적 실행을 보장
        - JVM은 client / server 버전으로 출시
            - server는 최적화된 속도로 수행
        - JVM이 virtual이라 불리는 이유는 실행하는 기계의 os/hw에 종속적이지 않기 때문
        - **[ClassLoader]**
            - 클래스 파일을 로드하는데 사용
            1. Loading
                - Bootstrap - Extension - Application 수행
                - 클래스 파일 로드할 때, JVM은 임의의 클래스에 의존성을 찾아냄
                - Bootstrap은 jre\lib\rt.jar 파일을 스캔
                - 못 찾으면, Extension 클래스 로더가 클래스 파일을 jre\lib\ext에서 찾아봄
                - 못 찾으면, Application 클래스 로더가 모든 jar 파일과 classpath내의 클래스를 찾아봄
                - 이래도 못 찾으면 ClassNotFoundException 발생
            2. Linking
                - 클래스가 클래스 로더에 로딩되면, 링킹이 수행됨
                - Bytecode verifier가 생성된 바이트코드가 올바른지 검증
                - static 변수들과 클래스 메서드들의 메모리 배치를 수행
            3. Initialization
                - Static 변수들이 할당
                - Static 블록이 수행!
        - **[JVM Memory Area]**
            - **Method Area**
                - 클래스 구조를 메타데이터 처럼 가짐
                - Constant Runtime Pool
                - 메서드의 코드
            - **Heap**
                - 어플리케이션 수행중에 생성되는 객체 저장
            - **Stacks**
                - 각 스레드에서 로컬 변수, 중간 연산 결과 저장
                - 각 스레드 별로 JVM 스택이 있음
            - **PC register**
                - Statement의 물리적 주소를 저장
                - 각 스레드 별로 PC register
            - **Native Code**
                - C/C++ Low level 코드를 스택에서 실행
        - **[JVM Execution Engine]**
            - 모든 코드는 Execution Engine에 할당됨
                - 하나씩 수행
                - Interpreter, JIT compiler를 통해 바이트코드 -> 머신코드
            - **Interpreter**
                - 바로 바이트 코드를 최적화 없이 수행
            - **JIT Compiler**
                - 코드 블럭을 가져와 최적화하고 머신코드로 바꿈
                - 기본적으로 사용됨