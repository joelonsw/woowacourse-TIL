### 2021-05-16

## 토비의 스프링 2단원

#### 핵심 내용
- 객체 지향 기술과 더불어 다른 하나의 도구로 스프링이 강조하고 가치를 두는 것은 "테스트"

- __기존 테스트 + 수동 테스트의 문제점__
    - 1단원에서 작성한 테스트는 main() 메서드를 통해 테스트를 수행함... 단점이 많음
        - 수동 확인 작업 필요
        - 실행 작업 번거로움
        - 제어권을 직접 가진다는 것이 프레임워크의 컨셉에 안어울림
    - 웹 화면을 통한 테스트는 값 입력 -> 기능 수행 -> 결과 확인... 너무 번거로움
        - 모든 레이어 다 만들어야 테스트 가능하다는 단점
        
- __단위 테스트 + 자동 테스트__
    - 테스트하고자 하는 대상이 명확하다면, 그 대상에만 집중하여 테스트하는 것이 바람직하다
        - 작은 단위의 코드에 대한 테스트를 "단위 테스트"라고 한다
            - 단위 테스트는 항상 일관성 있는 결과가 보장 되어야 함
                - DB에 남아 있는 데이터와 외부 환경에 영향 받지 않아야 함
                - 테스트 실행 순서 바뀌어도 동일한 결과여야 함
    - 테스트는 자동으로 수행되도록 코드로 만드는 것이 중요하다
        - 어떤 개발자는 모든 클래스가 스스로 테스트 하는 main() 메서드를 가지고 있어야 한다고 주장
        - 어찌되었든, 코드가 만들어져 자동으로 수행될 수 있어야 하는 것은 매우 중요!
        - 자동 테스트는 자주 반복하기 용이함

- __테스트의 장점__
    - 단순 무식한 방법으로 정상 동작하는 코드 만들고, 테스트를 통해 점진적 리팩토링 가능
    - 최종적으로 모든 테스트가 성공하면, 새로 추가한 기능도 정상적으로 동작하고 기존 기능에 영향 안 줌 확인 가능    
    - "항상 네거티브 테스트를 먼저 만들 것"
        - 성공할 거 알고 짠 테스트는 무의미

- __TDD__
    - 선 테스트, 후 프로덕션
    - 테스트를 빼먹지 않고 꼼꼼하게 만들 수 있음
    - 테스트 ~ 프로덕션 작성 시간 Short
    - 테스트 덕에 오류 빨리 잡아내서 개발 속도 Fast

- __Junit__
    - 테스트 수행 방식
        1. @Test + public void 형의 테스트 메서드 찾기
        2. 테스트 클래스 "오브젝트 생성"
        3. @Before 붙은 메서드 실행
        4. @Test 붙은 메서드 실행
        5. @After 붙은 메서드 실행
    - 각각의 테스트 메서드 실행할 때마다 테스트 클래스의 오브젝트 새로 만든다!
        - 한 번 만들어진 테스트 클래스의 오브젝트는 하나의 테스트 메서드 사용하고 난 후 버려짐
        - 각 테스트가 서로 영향 주지 않고 독립적으로 실행함을 보장하려고 이렇게 설계

- __테스트를 위한 애플리케이션 컨텍스트 관리__
    - 애플리케이션 컨텍스트는 생성에 많은 시간이 소모됨
        - 원칙적으론 매 테스트 마다 새로 생성해야 하지만, 이를 공유하는 경우도 있음
    - 테스트에서 사용할 설정파일을 지정해두고, @Autowired를 통해 주입시킬 수 있음
        ```java
        @RunWith(SpringJUnit4ClassRunner.class)
        @ContextConfiguration(classes = DaoFactory.class)
        public class UserDaoTest {
        
            @Autowired
            private UserDao dao;
        }
        ```
    - 테스트에서도 인터페이스를 사용해 애플리케이션 코드와 느슨하게 연결해두자
    - @DirtiesContext
        - 스프링의 테스트 컨텍스트 프레임워크에게 해당 클래스의 테스트에서 애플리케이션 컨텍스트의 상태 변경한다는 것을 알려줌
        - 해당 어노테이션이 붙으면 애플리케이션 컨텍스트 공유를 허용하지 않음
            - 따라서 뒤에 테스트 영향 X
    - 테스트 방법 선택 시 고려할 사항
        1. 스프링 컨테이너 없이 테스트 가능하다면 그렇게 하자
        2. 테스트에서 애플리케이션 컨텍스트 사용한다면 테스트 전용 설정 파일을 만들어두자
        3. 예외 적인 의존 관계를 강제로 구성해야 한다면... 
            - 컨텍스트에서 DI 받은 오브젝트에 다시 테스트 코드로 수동 DI 해서 테스트하도록 하자
            
#### 추가 공부 부분
- Configuration에 대한 공부가 하나도 안되어 있음
- @DirtiesContext에 대해서도 공부할 것

## 방화벽?